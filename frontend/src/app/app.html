<div
  class="app-shell app-scroll flex min-h-dvh overflow-x-clip flex-col relative bg-transparent text-base-content">
  <!-- Hafif doku -->
  <div aria-hidden="true" class="pointer-events-none fixed inset-0 -z-30 opacity-[0.05] bg-noise"></div>

  <!-- Gradient bloblar -->
  <div aria-hidden="true" class="pointer-events-none fixed inset-0 -z-40">
    <div class="absolute -top-24 -left-24 h-[520px] w-[520px] rounded-full bg-primary/10 blur-3xl"></div>
    <div class="absolute -top-32 right-[-8rem] h-[460px] w-[460px] rounded-full bg-secondary/10 blur-3xl"></div>
    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/4 h-[380px] w-[680px] rounded-[48%] bg-accent/10 blur-3xl"></div>
  </div>

  <!-- === GLOBAL BACKGROUND SCENE === -->
  <div class="background-scene absolute inset-0 -z-10 overflow-hidden pointer-events-none" aria-hidden="true">
    <div class="sun-moon"></div>
    <div class="clouds-stars"></div>
    <div class="bushes absolute bottom-0 w-full"></div>
  </div>

  <!-- NAVBAR -->
  <nav class="fixed top-0 left-0 right-0 z-50 overflow-visible
             bg-base-100/80 backdrop-blur supports-[backdrop-filter]:bg-base-100/60
             border-b border-base-300 shadow-sm">
    <div class="mx-auto max-w-6xl px-3 sm:px-4 h-14 flex items-center justify-between">
      <!-- Logo -->
      <a routerLink="/" class="text-lg font-extrabold tracking-tight hover:text-primary transition-colors">
        MyPortfolio
      </a>

      <!-- Desktop menu -->
      <div class="hidden md:flex items-center gap-1">
        <a routerLink="/" [routerLinkActive]="['text-primary','font-semibold','bg-base-200','rounded-md']" [routerLinkActiveOptions]="{ exact: true }" class="px-3 py-2 text-base-content/80 hover:text-base-content hover:bg-base-200 transition-colors">Ana Sayfa</a>
        <a routerLink="/documents" [routerLinkActive]="['text-primary','font-semibold','bg-base-200','rounded-md']" class="px-3 py-2 text-base-content/80 hover:text-base-content hover:bg-base-200 transition-colors">Belgeler</a>
        <a routerLink="/projects"  [routerLinkActive]="['text-primary','font-semibold','bg-base-200','rounded-md']" class="px-3 py-2 text-base-content/80 hover:text-base-content hover:bg-base-200 transition-colors">Projeler</a>
        <a routerLink="/contact"   [routerLinkActive]="['text-primary','font-semibold','bg-base-200','rounded-md']" class="px-3 py-2 text-base-content/80 hover:text-base-content hover:bg-base-200 transition-colors">İletişim</a>

        <!-- Admin dropdown (desktop) -->
        <div class="relative overflow-visible" *ngIf="auth.isAdmin()">
          <button
            type="button"
            class="px-3 py-2 rounded-md transition-colors"
            [ngClass]="adminOpen
              ? 'bg-base-200/70 font-semibold text-primary ring-1 ring-base-300'
              : 'text-base-content/80 hover:text-base-content hover:bg-base-200'"
            (click)="adminOpen = !adminOpen"
            aria-haspopup="menu"
            [attr.aria-expanded]="adminOpen">
            Admin
          </button>

          <!-- Dışarı tıkla -->
          <div *ngIf="adminOpen" class="fixed inset-0 z-40" (click)="adminOpen=false"></div>

          <!-- Menü -->
          <div
            *ngIf="adminOpen"
            class="absolute right-0 top-full mt-2 z-[60]"
            (keydown.escape)="adminOpen=false"
            role="menu"
            aria-label="Admin menüsü">

            <!-- küçük caret -->
            <span class="absolute -top-1 right-6 h-3 w-3 rotate-45 bg-base-100 border-t border-l border-base-300"></span>

            <div
              class="soft-card surface-2 rounded-xl ring-1 ring-base-300 shadow-lg backdrop-blur
                    min-w-[14rem] p-1.5">
              <a routerLink="/admin/panel"        (click)="adminOpen=false"
                class="flex items-center gap-2 px-3 py-2 rounded-lg nav-link hover:bg-base-200/70">
                <i class="pi pi-sliders-h text-primary"></i>
                <span>Admin Panel</span>
              </a>
              <a routerLink="/admin/project-form" (click)="adminOpen=false"
                class="flex items-center gap-2 px-3 py-2 rounded-lg nav-link hover:bg-base-200/70">
                <i class="pi pi-plus text-secondary"></i>
                <span>Proje Ekle</span>
              </a>
              <a routerLink="/admin/cv-upload"    (click)="adminOpen=false"
                class="flex items-center gap-2 px-3 py-2 rounded-lg nav-link hover:bg-base-200/70">
                <i class="pi pi-upload text-accent"></i>
                <span>Belge Yükle</span>
              </a>
              <a routerLink="/admin/profile"      (click)="adminOpen=false"
                class="flex items-center gap-2 px-3 py-2 rounded-lg nav-link hover:bg-base-200/70">
                <i class="pi pi-user-edit text-primary"></i>
                <span>Profil Düzenle</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Sağ: Tema switch + Auth (desktop) -->
      <div class="hidden md:flex items-center gap-3">
        <!-- Kaydırmalı tema anahtarı (DESKTOP) -->
        <button
          class="relative h-6 w-16 rounded-full ring-1 ring-base-300 bg-base-200/70 hover:bg-base-200
                 shadow-inner transition-colors focus:outline-none flex items-center justify-between px-2"
          (click)="setTheme(isDark ? 'light' : 'dark')"
          [attr.aria-pressed]="isDark"
          title="Temayı değiştir"
          aria-label="Temayı değiştir">

          <!-- Güneş -->
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="pointer-events-none"
              style="color:hsl(var(--wa));">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/>
          </svg>

          <!-- Ay -->
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="pointer-events-none"
              style="color:hsl(var(--in));">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>

          <!-- Knob: ring + dolu renk, yavaş ve net -->
          <span class="absolute top-1 left-1 h-4 w-6 rounded-full ring-1 ring-base-300 shadow-md
                      transition-transform duration-600 ease-in-out will-change-transform"
                [ngStyle]="{
                  'background': isDark
                    ? 'linear-gradient(135deg, hsl(var(--s)) 0%, hsl(var(--p)) 100%)'
                    : 'linear-gradient(135deg, #fff 0%, hsl(var(--b2)) 100%)'
                }"
                [class.translate-x-8]="isDark">
          </span>
        </button>

        <!-- giriş/çıkış -->
        <a *ngIf="!auth.isLoggedIn()" routerLink="/admin/login"
          class="inline-flex items-center justify-center gap-1.5 px-3.5 h-6
                rounded-full ring-1 ring-base-300 border-0 shadow-inner select-none
                btn-primary-solid text-sm"
          style="background-image:linear-gradient(90deg,hsl(var(--p)),hsl(var(--s))); color:hsl(var(--pc));">
          <span class="block font-medium leading-none">Giriş</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="block shrink-0 transition-transform duration-300 ease-out">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </a>
        <!-- çıkış butonu -->
        <button *ngIf="auth.isLoggedIn()" (click)="logout()" 
          class="inline-flex items-center justify-center gap-1.5 px-3.5 h-6
                rounded-full ring-1 ring-error border-0 shadow-inner select-none
                btn-error text-sm text-error-content"
                style="background-image:linear-gradient(90deg,hsl(var(--er)),hsl(var(--wa))); color:#fff;"
          aria-label="Çıkış yap">
          <span class="block font-medium leading-none">Çıkış</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="block shrink-0 transition-transform duration-300 ease-out">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
            <polyline points="10 17 15 12 10 7"></polyline>
            <line x1="15" y1="12" x2="3" y2="12"></line>
          </svg>
        </button>
      </div>

      <!-- Mobile burger -->
      <button class="md:hidden btn btn-ghost btn-sm z-[97]" (click)="mobileOpen = true" aria-label="Menüyü aç">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- MOBILE SHEET -->
  <div class="md:hidden" *ngIf="mobileOpen">
    <!-- Arkaplan -->
    <div class="fixed inset-0 z-[98] bg-black/50 backdrop-blur-sm" (click)="mobileOpen=false"></div>

    <!-- Sheet -->
    <div class="fixed top-0 right-0 bottom-0 z-[99] w-80">
      <div class="soft-card comic-outline surface-2 h-full max-h-screen overflow-y-auto p-3 flex flex-col" (keydown.escape)="mobileOpen=false">
        <!-- Header -->
        <div class="flex items-center justify-between px-1 py-2 border-b border-base-300">
          <span class="font-bold">Menü</span>
          <div class="flex items-center gap-2">
            <!-- Tema balonu -->
            <button
              class="relative h-6 w-16 rounded-full ring-1 ring-base-300 bg-base-200/70 hover:bg-base-200
                    shadow-inner transition-colors focus:outline-none flex items-center justify-between px-2"
              (click)="setTheme(isDark ? 'light' : 'dark')"
              [attr.aria-pressed]="isDark"
              title="Temayı değiştir"
              aria-label="Temayı değiştir">

              <!-- Güneş -->
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="pointer-events-none"
                  style="color:hsl(var(--wa));">
                <circle cx="12" cy="12" r="4"></circle>
                <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/>
              </svg>

              <!-- Ay -->
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="pointer-events-none"
                  style="color:hsl(var(--in));">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
              </svg>

              <!-- Knob: ring + dolu renk, yavaş ve net -->
              <span class="absolute top-1 left-1 h-4 w-6 rounded-full ring-1 ring-base-300 shadow-md
                          transition-transform duration-600 ease-in-out will-change-transform"
                    [ngStyle]="{
                      'background': isDark
                        ? 'linear-gradient(135deg, hsl(var(--s)) 0%, hsl(var(--p)) 100%)'
                        : 'linear-gradient(135deg, #fff 0%, hsl(var(--b2)) 100%)'
                    }"
                    [class.translate-x-8]="isDark">
              </span>
            </button>
            <button class="btn btn-ghost btn-sm" (click)="mobileOpen=false" aria-label="Kapat">✕</button>
          </div>
        </div>

        <!-- Nav -->
        <nav class="mt-2 flex flex-col gap-2">
          <a routerLink="/" [routerLinkActive]="['text-primary','font-semibold']" [routerLinkActiveOptions]="{ exact: true }" (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Ana Sayfa</a>
          <a routerLink="/documents" [routerLinkActive]="['text-primary','font-semibold']" (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Belgeler</a>
          <a routerLink="/projects"  [routerLinkActive]="['text-primary','font-semibold']" (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Projeler</a>
          <a routerLink="/contact"   [routerLinkActive]="['text-primary','font-semibold']" (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">İletişim</a>

          <ng-container *ngIf="auth.isAdmin()">
            <div class="my-2 border-t border-base-300"></div>
            <p class="text-xs uppercase font-semibold px-3 text-base-content/60">Admin</p>
            <div class="grid gap-2">
              <a routerLink="/admin/panel"        (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Admin Panel</a>
              <a routerLink="/admin/project-form" (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Proje Ekle</a>
              <a routerLink="/admin/cv-upload"    (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Belge Yükle</a>
              <a routerLink="/admin/profile"      (click)="mobileOpen=false" class="px-3 py-2 rounded surface-1 hover:bg-base-200 transition-colors">Profil Düzenle</a>
            </div>
          </ng-container>

          <div class="mt-auto pt-3 grid gap-2">
            <!-- GİRİŞ (mobil balon) -->
            <a *ngIf="!auth.isLoggedIn()" routerLink="/admin/login"
              class="inline-flex items-center justify-center gap-1.5 px-3.5 h-6
                    rounded-full ring-1 ring-base-300 border-0 shadow-inner select-none
                    btn-primary-solid text-sm"
              style="background-image:linear-gradient(90deg,hsl(var(--p)),hsl(var(--s))); color:hsl(var(--pc));">
              <span class="block font-medium leading-none">Giriş</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="block shrink-0 transition-transform duration-300 ease-out">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
            </a>
            <!-- çıkış butonu -->
            <button *ngIf="auth.isLoggedIn()" (click)="logout()" 
              class="inline-flex items-center justify-center gap-1.5 px-3.5 h-6
                    rounded-full ring-1 ring-error border-0 shadow-inner select-none
                    btn-error text-sm text-error-content"
                    style="background-image:linear-gradient(90deg,hsl(var(--er)),hsl(var(--wa))); color:#fff;"
              aria-label="Çıkış yap">
              <span class="block font-medium leading-none">Çıkış</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="block shrink-0 transition-transform duration-300 ease-out">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
              </svg>
            </button>
          </div>

        </nav>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <main class="flex-1 relative z-10 pt-14 md:pt-16 pb-12">
    <p-toast position="top-right" appendTo="body" [baseZIndex]="9999" [preventOpenDuplicates]="true" [style]="{ top: '72px' }"></p-toast>
    <router-outlet></router-outlet>
  </main>

  <footer class="mt-auto bg-transparent">
    <div class="mx-auto max-w-6xl px-3 sm:px-4 py-2 sm:py-2.5 flex flex-col sm:flex-row items-center sm:justify-between gap-2">
      <p class="text-xs text-base-content/60 text-center sm:text-left leading-none">
        © {{ currentYear }} <span class="font-medium text-base-content/80">Salih Karakaya</span> — kişisel portfolyo
      </p>
      <div class="footer-social flex items-center justify-center gap-4">
        <a href="https://instagram.com/slhkrkya" target="_blank" rel="noopener"
           aria-label="Instagram" style="color:hsl(var(--a));">
          <i class="pi pi-instagram text-lg"></i>
        </a>
        <a href="https://www.linkedin.com/in/salih-karakaya-a43818299/" target="_blank" rel="noopener"
           aria-label="LinkedIn" style="color:hsl(var(--s));">
          <i class="pi pi-linkedin text-lg"></i>
        </a>
        <a href="https://github.com/slhkrkya" target="_blank" rel="noopener"
           aria-label="GitHub" style="color:hsl(var(--bc)/.8);">
          <i class="pi pi-github text-lg"></i>
        </a>
        <a href="https://wa.me/905369749036?text=Merhaba%2C%20portfolyonuzdan%20ula%C5%9F%C4%B1yorum."
           target="_blank" rel="noopener"
           aria-label="WhatsApp" style="color:hsl(var(--su));">
          <i class="pi pi-whatsapp text-lg"></i>
        </a>
      </div>
    </div>
  </footer>
</div>
